<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SHSSM Newsletter Inaugural Issue</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: #5c4033;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        .flipbook-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .book-wrapper {
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            flex: 1;
            width: 100%;
            overflow: hidden;
            transform-origin: center center;
            transition: transform 0.3s ease;
        }

        #flipbook {
            margin: 0 auto;
            position: relative;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .page {
            background: white;
            border: 1px solid #ddd;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            transform-origin: center center;
        }

        .page img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            border-radius: 4px;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        
        /* Enhanced hover effects for page edges */
        .page.hover-left {
            transform: perspective(1000px) rotateY(2deg) translateX(3px) translateZ(5px);
            box-shadow: 3px 6px 12px rgba(0, 0, 0, 0.25);
            z-index: 5;
        }
        
        .page.hover-right {
            transform: perspective(1000px) rotateY(-2deg) translateX(-3px) translateZ(5px);
            box-shadow: -3px 6px 12px rgba(0, 0, 0, 0.25);
            z-index: 5;
        }
        
        /* Enhanced drag-to-flip tilting styles with better feedback */
        .page.tilting-left {
            transform: perspective(1000px) rotateY(8deg) translateX(15px) translateZ(10px);
            box-shadow: 8px 8px 20px rgba(0, 0, 0, 0.35);
            z-index: 15;
            filter: brightness(1.05);
        }
        
        .page.tilting-right {
            transform: perspective(1000px) rotateY(-8deg) translateX(-15px) translateZ(10px);
            box-shadow: -8px 8px 20px rgba(0, 0, 0, 0.35);
            z-index: 15;
            filter: brightness(1.05);
        }
        
        .page.tilting-strong-left {
            transform: perspective(1000px) rotateY(20deg) translateX(30px) translateZ(20px);
            box-shadow: 15px 12px 30px rgba(0, 0, 0, 0.5);
            z-index: 20;
            filter: brightness(1.1);
        }
        
        .page.tilting-strong-right {
            transform: perspective(1000px) rotateY(-20deg) translateX(-30px) translateZ(20px);
            box-shadow: -10px 12px 30px rgba(0, 0, 0, 0.5);
            z-index: 20;
            filter: brightness(1.1);
        }



        .book-wrapper.grabbing,
        .book-wrapper.grabbing .page {
            cursor: grabbing !important;
        }

        /* Improved hover zones for better edge detection */
        .page::before,
        .page::after {
            content: '';
            position: absolute;
            top: 0;
            bottom: 0;
            width: 50px;
            z-index: 1;
            pointer-events: none;
            transition: background 0.3s ease;
        }

        .page::before {
            left: 0;
            background: linear-gradient(to right, rgba(0, 0, 0, 0.03), transparent);
        }

        .page::after {
            right: 0;
            background: linear-gradient(to left, rgba(0, 0, 0, 0.03), transparent);
        }

        .page.hover-left::after {
            background: linear-gradient(to left, rgba(0, 0, 0, 0.08), transparent);
        }

        .page.hover-right::before {
            background: linear-gradient(to right, rgba(0, 0, 0, 0.08), transparent);
        }

        .controls {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            z-index: 1000;
        }

        .control-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .zoom-controls {
            position: fixed;
            top: 30px;
            right: 30px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
        }

        .zoom-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.5em;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .zoom-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .zoom-level {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 12px;
            border-radius: 15px;
            font-size: 0.9em;
            text-align: center;
            backdrop-filter: blur(10px);
            min-width: 60px;
        }

        .page-info {
            position: fixed;
            top: 30px;
            left: 30px;
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 12px 20px;
            border-radius: 20px;
            font-size: 1em;
            backdrop-filter: blur(10px);
            z-index: 1000;
        }

        /* Turn.js specific styles */
        .turn-page {
            background-color: white;
            background-size: 100% 100%;
        }

        /* Enhanced loading indicator */
        .loading-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            color: #666;
            font-size: 0.9em;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #666;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .page.loading .loading-indicator {
            display: flex;
        }

        .page:not(.loading) .loading-indicator {
            display: none;
        }

        /* Image placeholder */
        .image-placeholder {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #f5f5f5 0%, #e8e8e8 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            font-size: 0.9em;
            position: absolute;
            top: 0;
            left: 0;
        }

        .page:not(.loading) .image-placeholder {
            display: none;
        }

        /* Progress bar */
        .progress-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: rgba(255, 255, 255, 0.2);
            z-index: 1001;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #45a049);
            width: 0%;
            transition: width 0.3s ease;
        }

        .progress-container.hidden {
            display: none;
        }

        /* Mobile touch improvements */
        @media (max-width: 768px) {
            .controls {
                bottom: 20px;
                gap: 15px;
            }
            
            .control-btn {
                padding: 10px 20px;
                font-size: 0.9em;
            }
            
            .zoom-controls {
                top: 20px;
                right: 20px;
                gap: 8px;
            }
            
            .zoom-btn {
                width: 45px;
                height: 45px;
                font-size: 1.3em;
            }
            
            .page-info {
                top: 20px;
                left: 20px;
                padding: 10px 16px;
                font-size: 0.9em;
            }

            .drag-indicator {
                width: 50px;
                height: 50px;
                font-size: 20px;
            }
        }
    </style>
</head>
<body>

<div class="progress-container" id="progressContainer">
    <div class="progress-bar" id="progressBar"></div>
</div>

<div class="flipbook-container">
    <div class="page-info" id="pageInfo">Page 1 of 32</div>
    
    <div class="zoom-controls">
        <button class="zoom-btn" id="zoomInBtn">+</button>
        <div class="zoom-level" id="zoomLevel">100%</div>
        <button class="zoom-btn" id="zoomOutBtn">-</button>
        <button class="zoom-btn" id="resetBtn">⌂</button>
    </div>
    
    <div class="book-wrapper" id="bookWrapper">
        <div id="flipbook">
            </div>
    </div>
    
    <div class="controls">
        <button class="control-btn" id="prevBtn">← Previous</button>
        <button class="control-btn" id="nextBtn">Next →</button>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/turn.js/3/turn.min.js"></script>
    
<script>
    $(document).ready(function() {
        // Configuration
        const TOTAL_PAGES = 32;
        const PRELOAD_RANGE = 4;
        const IMAGE_BASE_PATH = 'images/'; // IMPORTANT: Make sure this path is correct
        const IMAGE_EXTENSION = '.png';
        const EDGE_HOVER_THRESHOLD = 60; // pixels from edge to trigger hover effect
        
        // State variables
        let currentZoom = 1;
        
        // Pan/drag state
        let isPanning = false;
        let panStartX, panStartY, panOffsetX = 0, panOffsetY = 0;

        // Drag-to-flip state
        let isDraggingToFlip = false;
        let dragStartX, dragCurrentX;
        let dragStartTime;
        
        // Image loading management
        const loadedImages = new Map();
        const loadingQueue = new Set();
        let totalImagesLoaded = 0;
        
        // jQuery Element Cache
        const $flipbook = $("#flipbook");
        const $bookWrapper = $("#bookWrapper");
        const $progressBar = $("#progressBar");
        const $progressContainer = $("#progressContainer");
        const $pageInfo = $("#pageInfo");
        const $prevBtn = $("#prevBtn");
        const $nextBtn = $("#nextBtn");
        const $zoomInBtn = $("#zoomInBtn");
        const $zoomOutBtn = $("#zoomOutBtn");
        const $resetBtn = $("#resetBtn");
        const $zoomLevel = $("#zoomLevel");

        // --- Page and Image Loading ---

        function generatePages() {
            for (let i = 1; i <= TOTAL_PAGES; i++) {
                const pageTitle = i === 1 ? 'Cover Page' : i === TOTAL_PAGES ? 'Back Cover' : `Page ${i}`;
                const pageHTML = `
                    <div class="page loading" data-page="${i}">
                        <div class="image-placeholder">Page ${i}</div>
                        <div class="loading-indicator">
                            <div class="spinner"></div>
                            <div>Loading...</div>
                        </div>
                        <img data-src="${IMAGE_BASE_PATH}Page-${i.toString().padStart(2, '0')}${IMAGE_EXTENSION}" 
                             alt="${pageTitle}" style="display: none;">
                    </div>`;
                $flipbook.append(pageHTML);
            }
        }

        function updateProgress() {
            const progress = TOTAL_PAGES > 0 ? (totalImagesLoaded / TOTAL_PAGES) * 100 : 0;
            $progressBar.css('width', `${progress}%`);
            if (totalImagesLoaded >= TOTAL_PAGES) {
                setTimeout(() => $progressContainer.addClass('hidden'), 500);
            }
        }

        function loadImage(pageNumber) {
            if (!pageNumber || loadedImages.has(pageNumber) || loadingQueue.has(pageNumber)) return;
            loadingQueue.add(pageNumber);
            const page = $(`.page[data-page="${pageNumber}"]`);
            if (!page.length) {
                loadingQueue.delete(pageNumber);
                return;
            }

            const imgElement = page.find('img');
            const imgSrc = imgElement.data('src');
            const image = new Image();
            image.onload = () => {
                imgElement.attr('src', imgSrc).show();
                page.removeClass('loading');
                loadedImages.set(pageNumber, true);
                loadingQueue.delete(pageNumber);
                totalImagesLoaded++;
                updateProgress();
            };
            image.onerror = () => {
                page.removeClass('loading').addClass('error');
                loadingQueue.delete(pageNumber);
                console.error(`Failed to load image for page ${pageNumber}: ${imgSrc}`);
            };
            image.src = imgSrc;
        }

        function preloadPages(centerPage) {
            for (let i = Math.max(1, centerPage - PRELOAD_RANGE); i <= Math.min(TOTAL_PAGES, centerPage + PRELOAD_RANGE); i++) {
                loadImage(i);
            }
        }

        // --- Flipbook Sizing and Initialization ---

        function calculateOptimalSize() {
            const viewportWidth = $(window).width();
            const viewportHeight = $(window).height();
            const aspectRatio = 8.3 / 11.7;

            let bookWidth = viewportWidth * 0.9;
            let bookHeight = bookWidth / (2 * aspectRatio);

            if (bookHeight > viewportHeight * 0.9) {
                bookHeight = viewportHeight * 0.9;
                bookWidth = bookHeight * (2 * aspectRatio);
            }

            return { width: Math.floor(bookWidth), height: Math.floor(bookHeight) };
        }
        
        function initializeFlipbook() {
            const size = calculateOptimalSize();
            $flipbook.turn({
                width: size.width,
                height: size.height,
                elevation: 50,
                gradients: true,
                autoCenter: true,
                duration: 800,
                when: {
                    turned: (event, page, view) => {
                        view.forEach(p => preloadPages(p));
                        updateControls();
                    }
                }
            });
            updateControls();
        }

        function resizeFlipbook() {
            const size = calculateOptimalSize();
            $flipbook.turn("size", size.width, size.height);
        }

        // --- UI Updates ---

        function updateControls() {
            const currentPage = $flipbook.turn('page');
            $pageInfo.text(`Page ${currentPage} of ${TOTAL_PAGES}`);
            $prevBtn.prop("disabled", currentPage <= 1);
            $nextBtn.prop("disabled", currentPage >= TOTAL_PAGES);
        }

        function updateZoom() {
            if (currentZoom === 1) {
                panOffsetX = 0; panOffsetY = 0;
            }
            $bookWrapper.css({
                transform: `scale(${currentZoom}) translate(${panOffsetX}px, ${panOffsetY}px)`,
                cursor: currentZoom > 1 ? "grab" : "default"
            });
            $zoomLevel.text(`${Math.round(currentZoom * 100)}%`);
            $zoomOutBtn.prop("disabled", currentZoom <= 0.5);
            $zoomInBtn.prop("disabled", currentZoom >= 2.0);
            $resetBtn.prop("disabled", currentZoom === 1 && panOffsetX === 0 && panOffsetY === 0);
        }
        
        function clearTiltEffects() {
            $(".page").removeClass("tilting-left tilting-right tilting-strong-left tilting-strong-right hover-left hover-right");
        }

        function handleEdgeHover(e) {
            if (isDraggingToFlip || isPanning || currentZoom > 1) return;
            
            const bookRect = $flipbook[0].getBoundingClientRect();
            const mouseX = e.clientX;
            const leftEdge = bookRect.left;
            const rightEdge = bookRect.right;
            const bookWidth = bookRect.width;
            
            clearTiltEffects();
            
            const currentPage = $flipbook.turn('page');
            
            // Left edge hover (for previous page)
            if (mouseX - leftEdge < EDGE_HOVER_THRESHOLD && currentPage > 1) {
                const $currentPageEl = $flipbook.find('.page[data-page="' + currentPage + '"]');
                $currentPageEl.addClass('hover-left');
            }
            // Right edge hover (for next page)
            else if (rightEdge - mouseX < EDGE_HOVER_THRESHOLD && currentPage < TOTAL_PAGES) {
                const targetPageNumber = (currentPage === 1) ? 1 : currentPage + 1;
                const $targetPageEl = $flipbook.find('.page[data-page="' + targetPageNumber + '"]');
                $targetPageEl.addClass('hover-right');
            }
        }

        // --- Event Handlers ---

        $flipbook.on('mousemove', handleEdgeHover);
        
        $flipbook.on('mouseleave', function() {
            if (!isDraggingToFlip && !isPanning) {
                clearTiltEffects();
            }
        });

        $bookWrapper.on('mousedown', function(e) {
            if (e.button !== 0) return;
            if (currentZoom > 1) {
                isPanning = true;
                panStartX = e.clientX - panOffsetX;
                panStartY = e.clientY - panOffsetY;
                $bookWrapper.addClass('grabbing');
            } else {
                isDraggingToFlip = true;
                dragStartX = dragCurrentX = e.clientX;
                dragStartTime = Date.now();
                $bookWrapper.addClass('grabbing');
                clearTiltEffects(); // Clear hover effects when starting drag
            }
            e.preventDefault();
        });

        $(document).on('mousemove', function(e) {
            if (isPanning) {
                panOffsetX = e.clientX - panStartX;
                panOffsetY = e.clientY - panStartY;
                updateZoom();
            } else if (isDraggingToFlip) {
                dragCurrentX = e.clientX;
                const deltaX = dragCurrentX - dragStartX;
                const dragStrength = Math.abs(deltaX);
                let pageToTilt = null;
                let indicatorSide = null;
                let isStrongDrag = dragStrength > 100;

                clearTiltEffects();
                
                const currentPage = $flipbook.turn('page');

                // Dragging RIGHT (to go to PREVIOUS page)
                if (deltaX > 20 && currentPage > 1) {
                    pageToTilt = $flipbook.find('.page[data-page="' + currentPage + '"]');
                    indicatorSide = 'left';
                    if (pageToTilt.length) {
                        pageToTilt.addClass(isStrongDrag ? 'tilting-strong-left' : 'tilting-left');
                    }
                } 
                // Dragging LEFT (to go to NEXT page)
                else if (deltaX < -20 && currentPage < TOTAL_PAGES) {
                    const targetPageNumber = (currentPage === 1) ? 1 : currentPage + 1;
                    pageToTilt = $flipbook.find('.page[data-page="' + targetPageNumber + '"]');
                    indicatorSide = 'right';
                    if (pageToTilt.length) {
                        pageToTilt.addClass(isStrongDrag ? 'tilting-strong-right' : 'tilting-right');
                    }
                }

                // Update drag indicators
                if (pageToTilt && pageToTilt.length && indicatorSide) {
                    const $indicator = pageToTilt.find('.drag-indicator.' + indicatorSide);
                    $indicator.addClass('active');
                    if (isStrongDrag) {
                        $indicator.addClass('strong');
                    }
                }
            }
        }).on('mouseup', function(e) {
            if (isDraggingToFlip) {
                const deltaX = dragCurrentX - dragStartX;
                const duration = Date.now() - dragStartTime;

                if (Math.abs(deltaX) > 50 && duration < 500) {
                    if (deltaX > 0) {
                        $flipbook.turn("previous");
                    } else {
                        $flipbook.turn("next");
                    }
                } else if (Math.abs(deltaX) < 10) {
                    const bookRect = $flipbook[0].getBoundingClientRect();
                    if (e.clientX < bookRect.left + bookRect.width / 2) {
                        $flipbook.turn("previous");
                    } else {
                        $flipbook.turn("next");
                    }
                }
                clearTiltEffects();
            }

            isPanning = false;
            isDraggingToFlip = false;
            $bookWrapper.removeClass('grabbing');
        });

        // Button Controls & Keyboard
        $prevBtn.on('click', () => $flipbook.turn("previous"));
        $nextBtn.on('click', () => $flipbook.turn("next"));
        $zoomInBtn.on('click', () => { currentZoom = Math.min(2.0, currentZoom + 0.1); updateZoom(); });
        $zoomOutBtn.on('click', () => { currentZoom = Math.max(0.5, currentZoom - 0.1); updateZoom(); });
        $resetBtn.on('click', () => { currentZoom = 1; updateZoom(); });
        $(document).on('keydown', function(e) {
            if (e.key === "ArrowLeft") $flipbook.turn("previous");
            else if (e.key === "ArrowRight") $flipbook.turn("next");
        });
        
        // Window Resize
        $(window).on('resize', resizeFlipbook);

        // --- Initialization ---
        generatePages();
        initializeFlipbook();
        updateZoom();
        preloadPages(1);
        preloadPages(2);
    });
</script>

</body>
</html>
